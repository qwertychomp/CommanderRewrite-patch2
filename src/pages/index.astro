---
import "tailwindcss/tailwind.css";
import "@fontsource/roboto/400.css";
import "@fontsource/roboto/500.css";
import "@fontsource/roboto/700.css";
import "@fontsource/montserrat/400.css";
import "@fontsource/montserrat/600.css";
import "@fontsource/montserrat/700.css";
import "@fontsource/nunito/600.css";

import cx from "classix";
import storage from "../lib/localStorage.ts";

const theme = storage.get("theme") || "default";
---

<style type="text/css">
    * {
        box-sizing: border-box;
    }

    #selectable {
        transition: 0.5s ease-in-out;
    }

    .selected {
        filter: brightness(75%);
        transform: scale(+1.10);
    }

    #nav-div-container a {
        border: 1.5px solid #38414a;
    }
</style>

<script>
    import setupBareMux from "../lib/bareMuxSetup";
    import storage from "../lib/localStorage";
    import rammerheadSearch from "../lib/rammerheadEncode";
    import Proxies from "../lib/swProxyEncode";
    import RegisterSW from "../lib/swRegister";

    window.onload = async () => {
        RegisterSW();
        setupBareMux();

        const parent = document.getElementById("selectables-parent");
        const selectableDivs = parent.querySelectorAll("#selectable");
        const input = document.getElementById("url-input");
        const button = document.getElementById("url-go");
        let selectedDiv = null;

        input.oninput = () => {
            const sw = new Proxies();

            input.onkeydown = async (e) => {
                if (e.key === "Enter") {
                    const proxy = storage.get("proxy");
                    // @ts-ignore
                    if (input.value.startsWith("http://") || input.value.startsWith("https://")) {
                        if (proxy === "rammerhead") {
                            // @ts-ignore
                            location.href = origin + await rammerheadSearch(input.value);
                        } else if (proxy === "ultraviolet") {
                            // @ts-ignore
                            location.href = origin + await sw.encodeUltraviolet(input.value);
                        } else {
                            // @ts-ignore
                            location.href = origin + await sw.encodeScramjet(input.value);
                        }
                    } else {
                        if (proxy === "rammerhead") {
                            location.href = origin + 
                                rammerheadSearch(
                                    "https://www.google.com/search?q=%s"
                                    // @ts-ignore
                                    .replace("%s", input.value)
                                );
                        } else if (proxy === "ultraviolet") {
                            location.href = origin +
                                sw.encodeUltraviolet(
                                    "https://www.google.com/search?q=%s"
                                    // @ts-ignore
                                    .replace("%s", input.value)
                                );
                        } else {
                            location.href = origin +
                                sw.encodeScramjet(
                                    "https://www.google.com/search?q=%s"
                                    // @ts-ignore
                                    .replace("%s", input.value)
                                );
                        }
                    }
                }
            };

            button.onclick = async () => {
                const proxy = storage.get("proxy");
                
                // @ts-ignore
                if (input.value.startsWith("http://") || input.value.startsWith("https://")) {
                        if (proxy === "rammerhead") {
                            // @ts-ignore
                            location.href = origin + await rammerheadSearch(input.value);
                        } else if (proxy === "ultraviolet") {
                            // @ts-ignore
                            location.href = origin + await sw.encodeUltraviolet(input.value);
                        } else {
                            // @ts-ignore
                            location.href = origin + await sw.encodeScramjet(input.value);
                        }
                } else {
                    if (proxy === "rammerhead") {
                        location.href = origin + 
                            rammerheadSearch(
                                "https://www.google.com/search?q=%s"
                                // @ts-ignore
                                .replace("%s", input.value)
                            );
                    } else if (proxy === "ultraviolet") {
                        location.href = origin +
                            sw.encodeUltraviolet(
                                "https://www.google.com/search?q=%s"
                                // @ts-ignore
                                .replace("%s", input.value)
                            );
                    } else {
                        location.href = origin +
                            sw.encodeScramjet(
                                "https://www.google.com/search?q=%s"
                                // @ts-ignore
                                .replace("%s", input.value)
                            );
                    }
                }
            };
        };

        selectableDivs.forEach((div) => {
            div.addEventListener("click", () => {
                selectableDivs.forEach((otherDiv) => {
                    otherDiv.classList.remove("selected");
                });
                div.classList.add("selected");
                selectedDiv = div;
                if (selectedDiv.querySelector("div").classList.toString().includes("ultraviolet")) {
                    storage.set("proxy", "ultraviolet");
                } else if (selectedDiv.querySelector("div").classList.toString().includes("rammerhead")) {
                    storage.set("proxy", "rammerhead");
                }
            });
        });

        document.addEventListener("click", (e) => {
            // @ts-ignore
            if (e.target !== parent && !parent.contains(e.target)) {
                if (selectedDiv) {
                    selectedDiv.classList.remove("selected");
                    selectedDiv = null;
                }
            }
        });

        if (storage.get("proxy") === "rammerhead") {
            // @ts-ignore
            document.querySelector("div[class^=\"bg-[url('/img/rammerhead.png')]\"]").click();
        } else if (storage.get("proxy") === "ultraviolet") {
            // @ts-ignore
            document.querySelector("div[class^=\"bg-[url('/img/ultraviolet.png')]\"]").click();
        } else {
            // @ts-ignore
            document.querySelector("div[class^=\"bg-[url('/img/ultraviolet.png')]\"]").click();
        }
    };
</script>

<script is:inline src="/baremux/bare.cjs" defer></script>
<script is:inline src="/baremux/index.js" defer></script>
<script is:inline src="/epoxy/index.js" defer></script>
<script is:inline src="/libcurl/index.js" defer></script>
<script is:inline src="/ultraviolet/uv.bundle.js" defer></script>
<script is:inline src="/ultraviolet/uv.config.js" defer></script>
<script is:inline src="/scramjet/scramjet.codecs.js" defer></script>
<script is:inline src="/scramjet/scramjet.config.js" defer></script>

<script is:inline src="/sw.js" defer></script>

<body
    class={
        cx((
            theme === "default" ?
            "bg-[#080d0f]" :
            theme === "read-write" ?
            "bg-[#2A3953]" :
            theme === "noctura" || theme === "molten" ?
            "bg-black" :
            theme === "bypassi" ?
            "bg-[#222222]" : 
            "bg-[#2c3d55]"
        ), "w-full min-h-screen flex justify-center items-center")
    }
    style={{
        // Default font weight property value
        fontWeight: 500,
        fontFamily: 
            theme === "default" ?
            "Roboto" :
            theme === "kahoot" ? 
            "Montserrat" :
            theme === "blooket" ?
            "Nunito" : 
            theme === "bypassi" ? 
            "Metropolis Semi Bold" : 
            "Roboto"
    }}
>
    <div 
        class={
            cx((
                theme === "default" ?
                "bg-[#080d0f]" :
                theme === "read-write" ? 
                "bg-[#506682]" :
                theme === "noctura" || theme === "molten" ?
                "bg-gray-900" :
                theme === "bypassi" ? 
                "bg-neutral-900" :
                "bg-[#3e4c5e]"
            ), "w-3/5 h-[28rem] flex justify-center items-center border-2 border-white rounded-lg gap-[28px] flex-col")
        }
        style="filter:brightness(89%)"
    >
        <div
            class="w-[100%] h-[15%] flex justify-center items-center flex-row gap-[10px]"
            id="nav-div-container"
            style={{
                color: "#f1f1f1",
                fontSize: "22px"
            }}
        >
            <a 
                href="/settings"
                title="Settings"
                class="w-[135px] p-[10px] gap-[10px] rounded-[35px] flex justify-center items-center text-center bg-[#323c46]"
                target="_blank"
            >
                <svg xmlns="http://www.w3.org/2000/svg" class="ionicon" viewBox="0 0 512 512" style="color:#f1f1f1;width:25.52;height:25.52"><path d="M262.29 192.31a64 64 0 1057.4 57.4 64.13 64.13 0 00-57.4-57.4zM416.39 256a154.34 154.34 0 01-1.53 20.79l45.21 35.46a10.81 10.81 0 012.45 13.75l-42.77 74a10.81 10.81 0 01-13.14 4.59l-44.9-18.08a16.11 16.11 0 00-15.17 1.75A164.48 164.48 0 01325 400.8a15.94 15.94 0 00-8.82 12.14l-6.73 47.89a11.08 11.08 0 01-10.68 9.17h-85.54a11.11 11.11 0 01-10.69-8.87l-6.72-47.82a16.07 16.07 0 00-9-12.22 155.3 155.3 0 01-21.46-12.57 16 16 0 00-15.11-1.71l-44.89 18.07a10.81 10.81 0 01-13.14-4.58l-42.77-74a10.8 10.8 0 012.45-13.75l38.21-30a16.05 16.05 0 006-14.08c-.36-4.17-.58-8.33-.58-12.5s.21-8.27.58-12.35a16 16 0 00-6.07-13.94l-38.19-30A10.81 10.81 0 0149.48 186l42.77-74a10.81 10.81 0 0113.14-4.59l44.9 18.08a16.11 16.11 0 0015.17-1.75A164.48 164.48 0 01187 111.2a15.94 15.94 0 008.82-12.14l6.73-47.89A11.08 11.08 0 01213.23 42h85.54a11.11 11.11 0 0110.69 8.87l6.72 47.82a16.07 16.07 0 009 12.22 155.3 155.3 0 0121.46 12.57 16 16 0 0015.11 1.71l44.89-18.07a10.81 10.81 0 0113.14 4.58l42.77 74a10.8 10.8 0 01-2.45 13.75l-38.21 30a16.05 16.05 0 00-6.05 14.08c.33 4.14.55 8.3.55 12.47z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"/></svg> settings
            </a>

            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" style="transform:rotate(90deg);width:24px;height:24px"><path d="M5.1 9.2C13.3-1.2 28.4-3.1 38.8 5.1l592 464c10.4 8.2 12.3 23.3 4.1 33.7s-23.3 12.3-33.7 4.1L9.2 42.9C-1.2 34.7-3.1 19.6 5.1 9.2z" fill="#f1f1f1"></path></svg>

            <a
                href="https://github.com/Quartinal/CommanderRewrite"
                title="Our Github repo!"
                class="w-[135px] p-[10px] gap-[10px] rounded-[35px] flex justify-center items-center text-center bg-[#323c46]"
                target="_blank"
            >
                <svg xmlns="http://www.w3.org/2000/svg" class="ionicon" viewBox="0 0 512 512" style="width:25.52;height:25.52"><path d="M256 32C132.3 32 32 134.9 32 261.7c0 101.5 64.2 187.5 153.2 217.9a17.56 17.56 0 003.8.4c8.3 0 11.5-6.1 11.5-11.4 0-5.5-.2-19.9-.3-39.1a102.4 102.4 0 01-22.6 2.7c-43.1 0-52.9-33.5-52.9-33.5-10.2-26.5-24.9-33.6-24.9-33.6-19.5-13.7-.1-14.1 1.4-14.1h.1c22.5 2 34.3 23.8 34.3 23.8 11.2 19.6 26.2 25.1 39.6 25.1a63 63 0 0025.6-6c2-14.8 7.8-24.9 14.2-30.7-49.7-5.8-102-25.5-102-113.5 0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8a18.64 18.64 0 015-.5c8.1 0 26.4 3.1 56.6 24.1a208.21 208.21 0 01112.2 0c30.2-21 48.5-24.1 56.6-24.1a18.64 18.64 0 015 .5c12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6 0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5 0 30.7-.3 55.5-.3 63 0 5.4 3.1 11.5 11.4 11.5a19.35 19.35 0 004-.4C415.9 449.2 480 363.1 480 261.7 480 134.9 379.7 32 256 32z" fill="#f1f1f1"/></svg> github
            </a>

            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" style="transform:rotate(90deg);width:24px;height:24px"><path d="M5.1 9.2C13.3-1.2 28.4-3.1 38.8 5.1l592 464c10.4 8.2 12.3 23.3 4.1 33.7s-23.3 12.3-33.7 4.1L9.2 42.9C-1.2 34.7-3.1 19.6 5.1 9.2z" fill="#f1f1f1"></path></svg>

            <a
                href="/apps"
                title="Apps"
                class="w-[135px] p-[10px] gap-[10px] rounded-[35px] flex justify-center items-center text-center bg-[#323c46]"
                target="_blank"
            >
                <svg xmlns="http://www.w3.org/2000/svg" class="ionicon" viewBox="0 0 512 512" style="color:#f1f1f1;width:25.52;height:25.52"><rect x="64" y="64" width="80" height="80" rx="40" ry="40" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"/><rect x="216" y="64" width="80" height="80" rx="40" ry="40" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"/><rect x="368" y="64" width="80" height="80" rx="40" ry="40" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"/><rect x="64" y="216" width="80" height="80" rx="40" ry="40" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"/><rect x="216" y="216" width="80" height="80" rx="40" ry="40" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"/><rect x="368" y="216" width="80" height="80" rx="40" ry="40" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"/><rect x="64" y="368" width="80" height="80" rx="40" ry="40" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"/><rect x="216" y="368" width="80" height="80" rx="40" ry="40" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"/><rect x="368" y="368" width="80" height="80" rx="40" ry="40" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"/></svg> apps
            </a>

            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" style="transform:rotate(90deg);width:24px;height:24px"><path d="M5.1 9.2C13.3-1.2 28.4-3.1 38.8 5.1l592 464c10.4 8.2 12.3 23.3 4.1 33.7s-23.3 12.3-33.7 4.1L9.2 42.9C-1.2 34.7-3.1 19.6 5.1 9.2z" fill="#f1f1f1"></path></svg>

            <a
                href="/games"
                title="Games"
                class="w-[135px] p-[10px] gap-[10px] rounded-[35px] flex justify-center items-center text-center bg-[#323c46]"
                target="_blank"
            >
                <svg xmlns="http://www.w3.org/2000/svg" class="ionicon" viewBox="0 0 512 512" style="color:#f1f1f1;width:25.52;height:25.52"><path d="M467.51 248.83c-18.4-83.18-45.69-136.24-89.43-149.17A91.5 91.5 0 00352 96c-26.89 0-48.11 16-96 16s-69.15-16-96-16a99.09 99.09 0 00-27.2 3.66C89 112.59 61.94 165.7 43.33 248.83c-19 84.91-15.56 152 21.58 164.88 26 9 49.25-9.61 71.27-37 25-31.2 55.79-40.8 119.82-40.8s93.62 9.6 118.66 40.8c22 27.41 46.11 45.79 71.42 37.16 41.02-14.01 40.44-79.13 21.43-165.04z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"/><circle cx="292" cy="224" r="20" fill="#f1f1f1"/><path d="M336 288a20 20 0 1120-19.95A20 20 0 01336 288z" fill="#f1f1f1"/><circle cx="336" cy="180" r="20" fill="#f1f1f1"/><circle cx="380" cy="224" r="20" fill="#f1f1f1"/><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M160 176v96M208 224h-96"/></svg> games
            </a>
        </div>

        <div
            class="w-[100%] h-[25%] flex justify-center items-center flex-row gap-[10px]"
            style={{
                color: "#f1f1f1",
                fontSize: "26px"
            }}
        >
            <h2>battle internet suppression right here, right now</h2>
        </div>

        <div
            class="w-[100%] h-[15%] flex justify-center items-center text-center flex-row gap-[30px]"
            style={{
                color: "#f1f1f1",
                fontSize: "18px"
            }}
            id="selectables-parent"
        >
            <div
                class="w-[auto] h-[auto] flex justify-center items-center flex-row gap-[2px]"
                id="selectable"
            >
                <div class="bg-[url('/img/rammerhead.png')] bg-contain bg-no-repeat w-[70px] h-[70px]"></div>
            </div>

            <div
                class="w-[auto] h-[auto] flex justify-center items-center flex-row gap-[2px]"
                id="selectable"
            >
                <div 
                    class="bg-[url('/img/ultraviolet.png')] bg-contain bg-no-repeat w-[70px] h-[70px]"
                ></div>
            </div>
        </div>

        <div
            class="w-[100%] h-[15%] flex justify-center items-center text-center flex-row gap-[0px]"
        >
            <input 
                type="text"
                style={{
                    display: "block",
                    paddingLeft: "30px",
                    borderTopLeftRadius: "35px",
                    borderBottomLeftRadius: "35px",
                    borderTopRightRadius: "0px",
                    borderBottomRightRadius: "0px",
                    backgroundColor: "#1e2933",
                    border: "2px solid #f1f1f1",
                    outline: "none",
                    width: "72%",
                    height: "100%",
                    color: "#f1f1f1",
                    fontSize: "18px",
                    fontWeight: "600",
                    fontFamily: "Montserrat",
                    textTransform: "lowercase"
                }}
                placeholder="search"
                spellcheck="false"
                autocomplete="off"
                id="url-input"
            >
            
            <button
                style={{
                    display: "flex",
                    alignItems: "center",
                    justifyContent: "center",
                    borderTopLeftRadius: "0px",
                    borderBottomLeftRadius: "0px",
                    borderTopRightRadius: "35px",
                    borderBottomRightRadius: "35px",
                    backgroundColor: "#1e2933",
                    borderTop: "2px solid #f1f1f1",
                    borderBottom: "2px solid #f1f1f1",
                    borderRight: "2px solid #f1f1f1",
                    borderLeft: "none",
                    outline: "none",
                    color: "#f1f1f1",
                    fontSize: "18px",
                    fontWeight: "600",
                    fontFamily: "Montserrat",
                    textTransform: "lowercase",
                    width: "21%",
                    height: "100%"
                }}
                id="url-go"
            >go</button>
        </div>
    </div>
</body>